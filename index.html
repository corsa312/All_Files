<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Links do reposit√≥rio All_Files</title>
  <style>
    body {
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      margin: 0;
      padding: 0;
      color: #222;
    }
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px;
      background: #24292f;
      color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    h1 {font-size: 1.5rem; margin: 0;}
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px auto;
      max-width: 900px;
      padding: 0 16px;
    }
    input[type=text], button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      outline: none;
    }
    input[type=text] { flex: 1; }
    button {
      background: #6f42c1;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #5936a2; }
    .meta, #status {
      margin: 10px auto;
      max-width: 900px;
      padding: 0 16px;
      color: #444;
      font-size: 0.9rem;
    }
    .list { max-width: 900px; margin: 20px auto; padding: 0 16px; }
    .folder { background: white; margin: 12px 0; padding: 12px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .folder h3 { margin: 0; font-size: 1.1rem; color: #6f42c1; display: flex; align-items: center; cursor: pointer; }
    .folder h3 .arrow { display: inline-block; margin-right: 6px; transition: transform 0.3s ease; }
    ul { list-style: none; padding: 0; margin: 8px 0 0; overflow: hidden; max-height: 0; transition: max-height 0.4s ease; }
    ul.open { max-height: 2000px; }
    li { margin: 6px 0; padding: 6px; border-radius: 6px; transition: background 0.2s; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    li:hover { background: #f5f0fa; }
    .btn { padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; text-decoration: none; font-weight: 500; transition: background 0.2s; }
    .btn-code { background: #6f42c1; color: white; }
    .btn-code:hover { background: #5936a2; }
    .btn-test { background: #28a745; color: white; }
    .btn-test:hover { background: #1c7c31; }
    small { color: #666; font-size: 0.8rem; }
    footer {
      text-align: center;
      padding: 20px;
      background: #24292f;
      color: white;
      margin-top: 40px;
      font-size: 0.85rem;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 10px auto;
      max-width: 900px;
      padding: 0 16px;
    }
    .filters label { font-size: 0.9rem; cursor: pointer; }
    .extra-links {
      max-width: 900px;
      margin: 20px auto;
      padding: 0 16px;
    }
    .extra-links a {
      display: inline-block;
      margin-right: 12px;
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      background: #0366d6;
      color: white;
      text-decoration: none;
      font-weight: 500;
    }
    .extra-links a:hover { background: #024c9c; }
  </style>
</head>
<body>
  <header>
    <svg width="40" height="40" viewBox="0 0 16 16" fill="white" aria-hidden><path d="M8 .198a7.802 7.802 0 00-2.466 15.218c.39.072.533-.17.533-.378 0-.186-.007-.679-.01-1.333-2.168.471-2.625-1.044-2.625-1.044-.354-.901-.866-1.143-.866-1.143-.708-.484.054-.474.054-.474.783.055 1.195.805 1.195.805.696 1.193 1.826.849 2.271.65.071-.506.273-.85.497-1.046-1.732-.197-3.553-.866-3.553-3.854 0-.852.305-1.55.805-2.096-.081-.197-.349-.99.077-2.063 0 0 .659-.211 2.16.8a7.47 7.47 0 011.968-.265c.67.003 1.345.09 1.968.265 1.5-1.01 2.158-.8 2.158-.8.428 1.073.16 1.866.08 2.063.5.546.803 1.244.803 2.096 0 2.994-1.825 3.653-3.563 3.846.281.244.532.725.532 1.462 0 1.055-.01 1.906-.01 2.165 0 .21.14.454.537.377A7.803 7.803 0 008 .198z"/></svg>
    <div>
      <h1>All_Files ‚Äî Links do Reposit√≥rio</h1>
      <div class="meta" style="color:#ddd">Carrega a lista de arquivos e gera links (raw/GitHub)</div>
    </div>
  </header>

  <div class="controls">
    <input id="search" type="text" placeholder="üîç Pesquisar por nome/extens√£o..." />
    <button id="refresh">‚ü≥ Atualizar</button>
    <button id="toggleView">üìÇ Modo: Pastas</button>
  </div>

  <div class="filters" id="filters"></div>

  <div class="meta">Reposit√≥rio: <a id="repoLink" href="#" target="_blank"></a></div>
  <div id="status" class="meta"></div>

  <div class="extra-links">
    <a href="https://snack.expo.dev/@corsa55/financeiro" target="_blank">React Financeiro</a>
    <a href="https://snack.expo.dev/@corsa55/lanche" target="_blank">React Lanchonete</a>
    <a href="https://snack.expo.dev/@corsa55/hello" target="_blank">App Hello</a>
    <a href="https://snack.expo.dev/@corsa55/conversor-unidade" target="_blank">React Conversor</a>
  </div>

  <div class="list" id="filesList"></div>

  <script>
    const owner = 'corsa312';
    const repo = 'All_Files';
    const branch = 'main';
    const repoUrl = `https://github.com/${owner}/${repo}`;
    document.getElementById('repoLink').href = repoUrl;
    document.getElementById('repoLink').textContent = repoUrl;

    const statusEl = document.getElementById('status');
    const filesList = document.getElementById('filesList');
    const searchInput = document.getElementById('search');
    const refreshBtn = document.getElementById('refresh');
    const filtersEl = document.getElementById('filters');
    const toggleBtn = document.getElementById('toggleView');

    let selectedExts = new Set();
    let rootData = null;
    let viewMode = "folders"; // "folders" ou "categories"

    async function loadTree() {
      statusEl.textContent = '‚è≥ Carregando lista de arquivos...';
      filesList.innerHTML = '';
      filtersEl.innerHTML = '';
      try {
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
        const res = await fetch(apiUrl);
        if(!res.ok) throw new Error('Erro ao acessar a API do GitHub: ' + res.status);
        const data = await res.json();
        const tree = data.tree || [];

        rootData = buildHierarchy(tree);

        const extensions = [...new Set(tree
          .filter(item => item.type === 'blob')
          .map(item => {
            const parts = item.path.split('.');
            return parts.length > 1 ? '.' + parts.pop().toLowerCase() : '(sem extens√£o)';
          })
        )].sort();

        const selectAllBtn = document.createElement('button');
        selectAllBtn.textContent = 'Desmarcar tudo';
        let allSelected = true;
        selectAllBtn.addEventListener('click', () => {
          allSelected = !allSelected;
          selectedExts.clear();
          filtersEl.querySelectorAll('input[type=checkbox]').forEach(chk => {
            chk.checked = allSelected;
            if(allSelected) selectedExts.add(chk.value);
          });
          selectAllBtn.textContent = allSelected ? 'Desmarcar tudo' : 'Selecionar tudo';
          renderAll();
        });
        filtersEl.appendChild(selectAllBtn);

        extensions.forEach(ext => {
          const label = document.createElement('label');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = ext;
          checkbox.checked = true;
          selectedExts.add(ext);
          checkbox.addEventListener('change', () => {
            if (checkbox.checked) {
              selectedExts.add(ext);
            } else {
              selectedExts.delete(ext);
            }
            renderAll();
          });
          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(' ' + ext));
          filtersEl.appendChild(label);
        });

        renderAll();
      } catch (err) {
        statusEl.textContent = '‚ùå Falha: ' + err.message;
      }
    }

    function renderAll() {
      if (viewMode === "folders") {
        filesList.innerHTML = '';
        let visibleCount = renderFolder(rootData, filesList);
        let totalCount = countFiles(rootData);
        statusEl.textContent = `‚úÖ Total de arquivos: ${totalCount} | Vis√≠veis: ${visibleCount}`;
      } else {
        renderCategories(rootData);
      }
    }

    function buildHierarchy(tree) {
      const root = { type: 'folder', name: '', children: {} };
      tree.forEach(item => {
        if (item.type !== 'blob') return;
        const parts = item.path.split('/');
        let current = root;
        parts.forEach((part, i) => {
          if (i === parts.length - 1) {
            current.children[part] = { type: 'file', name: part, path: item.path, size: item.size };
          } else {
            if (!current.children[part]) {
              current.children[part] = { type: 'folder', name: part, children: {} };
            }
            current = current.children[part];
          }
        });
      });
      return root;
    }

    function renderFolder(node, container) {
      const search = searchInput.value.trim().toLowerCase();
      const keys = Object.keys(node.children).sort((a, b) => a.localeCompare(b));
      let count = 0;
      const ul = document.createElement('ul');
      ul.classList.add('open');

      keys.forEach(key => {
        const child = node.children[key];
        if (child.type === 'folder') {
          const folderDiv = document.createElement('div');
          folderDiv.className = 'folder';
          const h = document.createElement('h3');
          const arrow = document.createElement('span');
          arrow.textContent = '‚ñ∂';
          arrow.className = 'arrow';
          h.appendChild(arrow);
          h.appendChild(document.createTextNode('üìÅ ' + child.name));
          folderDiv.appendChild(h);

          const subUl = document.createElement('ul');
          folderDiv.appendChild(subUl);
          container.appendChild(folderDiv);

          h.addEventListener('click', () => {
            const isOpen = subUl.classList.toggle('open');
            arrow.style.transform = isOpen ? 'rotate(90deg)' : 'rotate(0)';
          });

          count += renderFolder(child, subUl);
        } else if (child.type === 'file') {
          if (search && !child.name.toLowerCase().includes(search) && !child.path.toLowerCase().includes(search)) return;
          const ext = child.name.includes('.') ? '.' + child.name.split('.').pop().toLowerCase() : '(sem extens√£o)';
          if (!selectedExts.has(ext)) return;

          const li = document.createElement('li');
          const sizeText = formatSize(child.size);
          li.innerHTML = `${child.name} <small>(${sizeText})</small>`;

          const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${child.path}`;
          const testUrl = `https://raw.githack.com/${owner}/${repo}/${branch}/${child.path}`;

          const btnCode = document.createElement('a');
          btnCode.href = rawUrl;
          btnCode.target = '_blank';
          btnCode.className = 'btn btn-code';
          btnCode.textContent = 'Ver c√≥digo';
          li.appendChild(btnCode);

          if (child.name.toLowerCase().endsWith('.html')) {
            const btnTest = document.createElement('a');
            btnTest.href = testUrl;
            btnTest.target = '_blank';
            btnTest.className = 'btn btn-test';
            btnTest.textContent = '‚ñ∂ Testar';
            li.appendChild(btnTest);
          }

          ul.appendChild(li);
          count++;
        }
      });

      container.appendChild(ul);
      return count;
    }

    function categorizeFiles(node) {
      const categories = {
        "HTML": [".html", ".htm"],
        "CSS": [".css"],
        "JavaScript": [".js", ".jsx", ".ts", ".tsx"],
        "JSON": [".json"],
        "Imagens": [".png", ".jpg", ".jpeg", ".gif", ".svg", ".ico", ".webp"],
        "Markdown": [".md"],
        "Texto": [".txt", ".rtf"],
        "Outros": []
      };

      const result = {};
      Object.keys(categories).forEach(cat => result[cat] = []);

      function walk(node) {
        for (let key in node.children) {
          let child = node.children[key];
          if (child.type === "file") {
            const ext = child.name.includes(".") 
              ? "." + child.name.split(".").pop().toLowerCase()
              : "(sem extens√£o)";
            let placed = false;
            for (let cat in categories) {
              if (categories[cat].includes(ext)) {
                result[cat].push(child);
                placed = true;
                break;
              }
            }
            if (!placed) result["Outros"].push(child);
          } else {
            walk(child);
          }
        }
      }
      walk(node);
      return result;
    }

    function renderCategories(root) {
      filesList.innerHTML = "";
      const categorized = categorizeFiles(root);
      const search = searchInput.value.trim().toLowerCase();
      let total = 0;

      for (let cat in categorized) {
        const list = categorized[cat].filter(file => {
          if (search && !file.name.toLowerCase().includes(search) && !file.path.toLowerCase().includes(search)) return false;
          const ext = file.name.includes('.') ? '.' + file.name.split('.').pop().toLowerCase() : '(sem extens√£o)';
          return selectedExts.has(ext);
        });

        if (list.length === 0) continue;

        const div = document.createElement("div");
        div.className = "folder";

        const h = document.createElement("h3");
        const arrow = document.createElement("span");
        arrow.textContent = "‚ñ∂";
        arrow.className = "arrow";
        h.appendChild(arrow);
        h.appendChild(document.createTextNode("üìÇ " + cat));
        div.appendChild(h);

        const ul = document.createElement("ul");
        div.appendChild(ul);

        h.addEventListener("click", () => {
          const isOpen = ul.classList.toggle("open");
          arrow.style.transform = isOpen ? "rotate(90deg)" : "rotate(0)";
        });

        list.forEach(file => {
          const li = document.createElement("li");
          const sizeText = formatSize(file.size);
          li.innerHTML = `${file.name} <small>(${sizeText})</small>`;

          const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${file.path}`;
          const testUrl = `https://raw.githack.com/${owner}/${repo}/${branch}/${file.path}`;

          const btnCode = document.createElement("a");
          btnCode.href = rawUrl;
          btnCode.target = "_blank";
          btnCode.className = "btn btn-code";
          btnCode.textContent = "Ver c√≥digo";
          li.appendChild(btnCode);

          if (file.name.toLowerCase().endsWith(".html")) {
            const btnTest = document.createElement("a");
            btnTest.href = testUrl;
            btnTest.target = "_blank";
            btnTest.className = "btn btn-test";
            btnTest.textContent = "‚ñ∂ Testar";
            li.appendChild(btnTest);
          }

          ul.appendChild(li);
          total++;
        });

        filesList.appendChild(div);
      }

      statusEl.textContent = `‚úÖ Total de arquivos: ${countFiles(root)} | Vis√≠veis: ${total}`;
    }

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + " B";
      let kb = bytes / 1024;
      if (kb < 1024) return kb.toFixed(1) + " KB";
      let mb = kb / 1024;
      return mb.toFixed(1) + " MB";
    }

    function countFiles(node) {
      let count = 0;
      for (let key in node.children) {
        let child = node.children[key];
        if (child.type === 'file') count++;
        else count += countFiles(child);
      }
      return count;
    }

    refreshBtn.addEventListener('click', loadTree);
    searchInput.addEventListener('input', () => renderAll());
    toggleBtn.addEventListener('click', () => {
      viewMode = viewMode === "folders" ? "categories" : "folders";
      toggleBtn.textContent = viewMode === "folders" ? "üìÇ Modo: Pastas" : "üìë Modo: Categorias";
      renderAll();
    });

    loadTree();
  </script>

  <footer>Feito com ‚ù§Ô∏è para navegar no reposit√≥rio GitHub</footer>
</body>
</html>
